<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fencing Club AI Assistant</title>
    <!-- Tailwind CSS -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <!-- React & Babel -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Font -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans KR', 'Noto Sans SC', sans-serif;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <div class="max-w-4xl mx-auto">
            <!-- Header Section -->
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-gray-800 mb-4">Fencing Club AI Assistant</h1>
                <div class="inline-flex space-x-4 bg-white rounded-lg shadow p-2">
                    <button class="lang-btn px-4 py-2 rounded bg-blue-500 text-white hover:bg-blue-600 transition" data-lang="ko">í•œêµ­ì–´</button>
                    <button class="lang-btn px-4 py-2 rounded bg-blue-500 text-white hover:bg-blue-600 transition" data-lang="cn">ä¸­æ–‡</button>
                    <button class="lang-btn px-4 py-2 rounded bg-blue-500 text-white hover:bg-blue-600 transition" data-lang="en">English</button>
                </div>
            </div>
            
            <!-- Chatbot Container -->
            <div id="chatbot-root"></div>
        </div>
    </div>

    <!-- Chatbot Component -->
    <script type="text/babel">
        // Intent Patterns
        const INTENT_PATTERNS = {
            ko: {
                course: [/ìˆ˜ì—…/, /ê³¼ì •/, /ê°•ìŠµ/],
                schedule: [/ì‹œê°„/, /ì–¸ì œ/, /ìŠ¤ì¼€ì¤„/],
                price: [/ê°€ê²©/, /ë¹„ìš©/, /ìš”ê¸ˆ/],
                location: [/ìœ„ì¹˜/, /ì–´ë””/, /ì°¾ì•„/, /ì£¼ì†Œ/],
                greeting: [/ì•ˆë…•/, /í•˜ì´/, /hello/]
            },
            cn: {
                course: [/è¯¾ç¨‹/, /è¯¾/, /å­¦ä¹ /, /åŸ¹è®­/],
                schedule: [/æ—¶é—´/, /ä»€ä¹ˆæ—¶å€™/, /æ—¥ç¨‹/, /å‡ ç‚¹/],
                price: [/ä»·æ ¼/, /è´¹ç”¨/, /å¤šå°‘é’±/, /æ”¶è´¹/],
                location: [/ä½ç½®/, /åœ¨å“ª/, /æ€ä¹ˆèµ°/, /åœ°å€/],
                greeting: [/ä½ å¥½/, /æ‚¨å¥½/, /hi/, /å“ˆå•°/]
            },
            en: {
                course: [/class/, /course/, /lesson/, /training/, /learn/],
                schedule: [/time/, /when/, /schedule/, /hours/, /open/],
                price: [/price/, /cost/, /fee/, /charge/, /pay/, /much/],
                location: [/where/, /location/, /find/, /located/, /address/, /place/, /direction/],
                greeting: [/hi/, /hello/, /hey/, /good/]
            }
        };

        const ChatBot = ({ language = 'ko' }) => {
            const [messages, setMessages] = React.useState([]);
            const [input, setInput] = React.useState('');
            const [isLoading, setIsLoading] = React.useState(false);
            const chatEndRef = React.useRef(null);
            const [context, setContext] = React.useState({
                lastIntent: null,
                mentionedCourses: [],
                askedPrice: false,
                questionCount: 0
            });

            React.useEffect(() => {
                addMessage('bot', getWelcomeMessage(language));
            }, [language]);

            React.useEffect(() => {
                chatEndRef.current?.scrollIntoView({ behavior: 'smooth' });
            }, [messages]);

            const getWelcomeMessage = (lang) => {
                const messages = {
                    ko: "ì•ˆë…•í•˜ì„¸ìš”! íœì‹± í´ëŸ½ ë„ìš°ë¯¸ì…ë‹ˆë‹¤. ìˆ˜ì—…, ì‹œê°„, ê°€ê²©, ìœ„ì¹˜ì— ëŒ€í•´ ë¬¸ì˜í•´ì£¼ì„¸ìš”.",
                    cn: "æ‚¨å¥½ï¼æˆ‘æ˜¯å‡»å‰‘ä¿±ä¹éƒ¨åŠ©æ‰‹ã€‚è¯·è¯¢é—®è¯¾ç¨‹ã€æ—¶é—´ã€ä»·æ ¼å’Œä½ç½®ç›¸å…³é—®é¢˜ã€‚",
                    en: "Hello! I'm your fencing club assistant. Ask me about classes, schedules, pricing, and location."
                };
                return messages[lang];
            };

            const detectIntents = (input) => {
                const intents = [];
                Object.entries(INTENT_PATTERNS[language]).forEach(([intent, patterns]) => {
                    if (patterns.some(pattern => pattern.test(input.toLowerCase()))) {
                        intents.push(intent);
                    }
                });
                return intents;
            };

            const generateResponse = (intents, userInput) => {
                if (intents.length === 0) {
                    return getDefaultResponse(language, context.questionCount);
                }

                let response = '';
                intents.forEach(intent => {
                    switch (intent) {
                        case 'greeting':
                            response += getGreetingResponse(language) + '\n\n';
                            break;
                        case 'course':
                            response += getCourseInfo(language) + '\n\n';
                            setContext(prev => ({...prev, lastIntent: 'course'}));
                            break;
                        case 'schedule':
                            response += getScheduleInfo(language) + '\n\n';
                            break;
                        case 'price':
                            response += getPriceInfo(language) + '\n\n';
                            setContext(prev => ({...prev, askedPrice: true}));
                            break;
                        case 'location':
                            response += getLocationInfo(language) + '\n\n';
                            break;
                    }
                });

                response += getContextualSuggestions(language, context);
                
                setContext(prev => ({
                    ...prev, 
                    questionCount: prev.questionCount + 1
                }));

                return response.trim();
            };

            const getDefaultResponse = (lang, questionCount) => {
                if (questionCount === 0) {
                    const responses = {
                        ko: "ì£„ì†¡í•©ë‹ˆë‹¤. ì´í•´í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ìˆ˜ì—…, ì‹œê°„, ê°€ê²©, ìœ„ì¹˜ì— ëŒ€í•´ ë¬¸ì˜í•´ì£¼ì„¸ìš”.",
                        cn: "æŠ±æ­‰ï¼Œæˆ‘æ²¡æœ‰ç†è§£æ‚¨çš„é—®é¢˜ã€‚æ‚¨å¯ä»¥è¯¢é—®å…³äºè¯¾ç¨‹ã€æ—¶é—´ã€ä»·æ ¼æˆ–ä½ç½®çš„é—®é¢˜ã€‚",
                        en: "I'm sorry, I didn't understand. You can ask about classes, schedules, pricing, or location."
                    };
                    return responses[lang];
                }
                
                const responses = {
                    ko: "ì£„ì†¡í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ ë‹¤ìŒê³¼ ê°™ì´ ì§ˆë¬¸í•´ ì£¼ì„¸ìš”:\nâ€¢ 'ìˆ˜ì—… ì‹œê°„ì´ ì–´ë–»ê²Œ ë˜ë‚˜ìš”?'\nâ€¢ 'ìˆ˜ì—… ê°€ê²©ì´ ì–¼ë§ˆì¸ê°€ìš”?'\nâ€¢ 'í´ëŸ½ ìœ„ì¹˜ê°€ ì–´ë””ì¸ê°€ìš”?'",
                    cn: "æŠ±æ­‰ã€‚æ‚¨å¯ä»¥è¿™æ ·æé—®ï¼š\nâ€¢ 'è¯¾ç¨‹æ—¶é—´æ˜¯æ€æ ·çš„ï¼Ÿ'\nâ€¢ 'å­¦è´¹æ˜¯å¤šå°‘ï¼Ÿ'\nâ€¢ 'ä¿±ä¹éƒ¨åœ¨å“ªé‡Œï¼Ÿ'",
                    en: "I'm sorry. Try asking questions like:\nâ€¢ 'What are your class hours?'\nâ€¢ 'How much do lessons cost?'\nâ€¢ 'Where is the club located?'"
                };
                return responses[lang];
            };

            const getGreetingResponse = (lang) => {
                const responses = {
                    ko: "ì•ˆë…•í•˜ì„¸ìš”! ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”?",
                    cn: "æ‚¨å¥½ï¼éœ€è¦ä»€ä¹ˆå¸®åŠ©ï¼Ÿ",
                    en: "Hi there! How can I help you today?"
                };
                return responses[lang];
            };

            const getCourseInfo = (lang) => {
                const info = {
                    ko: {
                        trial: "ì²´í—˜ ìˆ˜ì—… (60ë¶„)\nâ€¢ íœì‹± ì…ë¬¸ìë¥¼ ìœ„í•œ ê¸°ì´ˆ ìˆ˜ì—…\nâ€¢ ê¸°ë³¸ ìì„¸ì™€ ë™ì‘ í•™ìŠµ\nâ€¢ ì¥ë¹„ ì œê³µ",
                        private: "ê°œì¸ ë ˆìŠ¨ (60ë¶„)\nâ€¢ ë§ì¶¤í˜• 1:1 ì „ë¬¸ ë ˆìŠ¨\nâ€¢ ì„¸ë¶€ ê¸°ìˆ  í›ˆë ¨\nâ€¢ ì˜ìƒ ë¶„ì„",
                        group: "ê·¸ë£¹ ìˆ˜ì—… (90ë¶„)\nâ€¢ ì‹¤ì „ ê²½í—˜ ìœ„ì£¼ í›ˆë ¨\nâ€¢ ìŠ¤íŒŒë§ ì—°ìŠµ\nâ€¢ ì „ìˆ  í›ˆë ¨"
                    },
                    cn: {
                        trial: "ä½“éªŒè¯¾ (60åˆ†é’Ÿ)\nâ€¢ å‡»å‰‘å…¥é—¨åŸºç¡€è¯¾ç¨‹\nâ€¢ åŸºæœ¬å§¿åŠ¿å’ŒåŠ¨ä½œå­¦ä¹ \nâ€¢ æä¾›è£…å¤‡",
                        private: "ç§æ•™è¯¾ (60åˆ†é’Ÿ)\nâ€¢ ä¸€å¯¹ä¸€ä¸“ä¸šæŒ‡å¯¼\nâ€¢ æŠ€æœ¯ç»†èŠ‚è®­ç»ƒ\nâ€¢ è§†é¢‘åˆ†æ",
                        group: "å›¢ä½“è¯¾ (90åˆ†é’Ÿ)\nâ€¢ å®æˆ˜ç»éªŒåŸ¹è®­\nâ€¢ å¯¹æˆ˜ç»ƒä¹ \nâ€¢ æˆ˜æœ¯è®­ç»ƒ"
                    },
                    en: {
                        trial: "Trial Class (60min)\nâ€¢ Introduction to fencing\nâ€¢ Basic stance and movements\nâ€¢ Equipment provided",
                        private: "Private Lesson (60min)\nâ€¢ Personalized coaching\nâ€¢ Detailed technique training\nâ€¢ Video analysis",
                        group: "Group Class (90min)\nâ€¢ Practice-oriented training\nâ€¢ Sparring sessions\nâ€¢ Tactical training"
                    }
                };
                
                return Object.values(info[lang]).join('\n\n');
            };

            const getScheduleInfo = (lang) => {
                const info = {
                    ko: "ìš´ì˜ì‹œê°„:\ní‰ì¼: 10:00-22:00\nì£¼ë§: 10:00-18:00\n\nìˆ˜ì—… ì‹œê°„:\nâ€¢ ì²´í—˜/ê°œì¸ ë ˆìŠ¨: ì˜ˆì•½ì œ\nâ€¢ ê·¸ë£¹ ìˆ˜ì—…: í‰ì¼ ì €ë… 7ì‹œ, ì£¼ë§ ì˜¤ì „ 10ì‹œ\n\n* ë ˆë²¨ê³¼ ê°•ì‚¬ ì¼ì •ì— ë”°ë¼ ì¡°ì • ê°€ëŠ¥",
                    cn: "è¥ä¸šæ—¶é—´:\nå·¥ä½œæ—¥: 10:00-22:00\nå‘¨æœ«: 10:00-18:00\n\nè¯¾ç¨‹æ—¶é—´:\nâ€¢ ä½“éªŒ/ç§æ•™è¯¾: éœ€é¢„çº¦\nâ€¢ å›¢ä½“è¯¾: å·¥ä½œæ—¥æ™š7ç‚¹, å‘¨æœ«æ—©10ç‚¹\n\n* å¯æ ¹æ®æ°´å¹³å’Œæ•™ç»ƒæ—¶é—´è°ƒæ•´",
                    en: "Business Hours:\nWeekdays: 10:00-22:00\nWeekends: 10:00-18:00\n\nClass Schedule:\nâ€¢ Trial/Private: By appointment\nâ€¢ Group: 7PM weekdays, 10AM weekends\n\n* Adjustable based on level and instructor"
                };
                return info[lang];
            };

            const getPriceInfo = (lang) => {
                const info = {
                    ko: "ê°€ê²© ì•ˆë‚´:\n\n1. ì²´í—˜ ìˆ˜ì—…\nâ€¢ 1íšŒ: 50,000ì›\nâ€¢ ì¥ë¹„ ëŒ€ì—¬ í¬í•¨\n\n2. ê°œì¸ ë ˆìŠ¨\nâ€¢ 1íšŒ: 100,000ì›\nâ€¢ 10íšŒ: 900,000ì›\n\n3. ê·¸ë£¹ ìˆ˜ì—…\nâ€¢ 1íšŒ: 80,000ì›\nâ€¢ ì›” íšŒì›: 300,000ì›(ì£¼ 2íšŒ)",
                    cn: "ä»·æ ¼ä¿¡æ¯:\n\n1. ä½“éªŒè¯¾\nâ€¢ å•æ¬¡: â‚©50,000\nâ€¢ å«è£…å¤‡ç§Ÿå€Ÿ\n\n2. ç§æ•™è¯¾\nâ€¢ å•æ¬¡: â‚©100,000\nâ€¢ 10æ¬¡: â‚©900,000\n\n3. å›¢ä½“è¯¾\nâ€¢ å•æ¬¡: â‚©80,000\nâ€¢ æœˆå¡: â‚©300,000(æ¯å‘¨2æ¬¡)",
                    en: "Pricing:\n\n1. Trial Class\nâ€¢ Single: â‚©50,000\nâ€¢ Equipment rental included\n\n2. Private Lesson\nâ€¢ Single: â‚©100,000\nâ€¢ 10 sessions: â‚©900,000\n\n3. Group Class\nâ€¢ Single: â‚©80,000\nâ€¢ Monthly: â‚©300,000(twice/week)"
                };
                return info[lang];
            };

            const getLocationInfo = (lang) => {
                const info = {
                    ko: "ìœ„ì¹˜ ì•ˆë‚´:\n\në³¸ì : ì„œìš¸ì‹œ ê°•ë‚¨êµ¬ ì‚¼ì„±ë™ 123-45\nâ€¢ ì§€í•˜ì²  2í˜¸ì„  ì‚¼ì„±ì¤‘ì•™ì—­ 3ë²ˆ ì¶œêµ¬ ë„ë³´ 5ë¶„\nâ€¢ ì£¼ì°¨ ê°€ëŠ¥\n\nì²´í—˜ìˆ˜ì—… ì˜ˆì•½ ë° ìƒë‹´: 02-123-4567",
                    cn: "ä½ç½®ä¿¡æ¯:\n\næ€»åº—: é¦–å°”å¸‚æ±Ÿå—åŒºä¸‰æˆæ´123-45\nâ€¢ åœ°é“2å·çº¿ä¸‰æˆä¸­å¤®ç«™3å·å‡ºå£æ­¥è¡Œ5åˆ†é’Ÿ\nâ€¢ å¯åœè½¦\n\nä½“éªŒè¯¾é¢„çº¦å’¨è¯¢: 02-123-4567",
                    en: "Location:\n\nMain Branch: 123-45 Samseong-dong, Gangnam-gu, Seoul\nâ€¢ 5 min walk from Exit 3, Samseong Central Station (Line 2)\nâ€¢ Parking available\n\nBooking & Inquiries: 02-123-4567"
                };
                return info[lang];
            };

            const getContextualSuggestions = (lang, context) => {
                const suggestions = [];
                
                if (context.lastIntent === 'course' && !context.askedPrice) {
                    suggestions.push({
                        ko: "ğŸ’¡ ìˆ˜ì—… ê°€ê²©ì´ ê¶ê¸ˆí•˜ì‹ ê°€ìš”?",
                        cn: "ğŸ’¡ æƒ³äº†è§£è¯¾ç¨‹ä»·æ ¼å—ï¼Ÿ",
                        en: "ğŸ’¡ Would you like to know about the class prices?"
                    });
                }
                
                if (context.lastIntent === 'price' || context.askedPrice) {
                    suggestions.push({
                        ko: "ğŸ’¡ ì²´í—˜ ìˆ˜ì—…ì„ ì˜ˆì•½í•˜ì‹œê² ìŠµë‹ˆê¹Œ?",
                        cn: "ğŸ’¡ è¦é¢„çº¦ä½“éªŒè¯¾å—ï¼Ÿ",
                        en: "ğŸ’¡ Would you like to book a trial class?"
                    });
                }

                if (suggestions.length === 0) return '';
                return '\n\n' + suggestions.map(s => s[lang]).join('\n');
            };

            const addMessage = (type, content) => {
                setMessages(prev => [...prev, { type, content, timestamp: new Date() }]);
            };

            const handleSubmit = async (e) => {
                e.preventDefault();
                if (!input.trim()) return;

                const userInput = input.trim();
                setInput('');
                addMessage('user', userInput);
                setIsLoading(true);

                try {
                    const intents = detectIntents(userInput);
                    const response = generateResponse(intents, userInput);
                    
                    await new Promise(resolve => setTimeout(resolve, 500));
                    addMessage('bot', response);
                } catch (error) {
                    console.error('Error:', error);
                    const errorMessages = {
                        ko: "ì£„ì†¡í•©ë‹ˆë‹¤. ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.",
                        cn: "æŠ±æ­‰ï¼Œå‘ç”Ÿé”™è¯¯ã€‚è¯·é‡è¯•ã€‚",
                        en: "Sorry, an error occurred. Please try again."
                    };
                    addMessage('error', errorMessages[language]);
                } finally {
                    setIsLoading(false);
                }
            };

            const placeholders = {
                ko: "ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”...",
                cn: "è¯·è¾“å…¥æ‚¨çš„é—®é¢˜...",
                en: "Type your question..."
            };

            return (
                <div className="bg-white rounded-lg shadow-lg overflow-hidden">
                    <div className="h-[500px] overflow-y-auto p-4">
                        {messages.map((message, index) => (
                            <div key={index} className={`mb-4 ${message.type === 'user' ? 'text-right' : 'text-left'}`}>
                                <div className={`inline-block p-3 rounded-lg max-w-[80%] whitespace-pre-wrap ${
                                    message.type === 'user' 
                                        ? 'bg-blue-500 text-white'
                                        : message.type === 'error'
                                            ? 'bg-red-100 text-red-800'
                                            : 'bg-gray-100 text-gray-800'
                                }`}>
                                    {message.content}
                                </div>
                            </div>
                        ))}
                        {isLoading && (
                            <div className="flex items-center space-x-2 text-gray-400">
                                <div className="w-2 h-2 rounded-full animate-bounce bg-gray-400"></div>
                                <div className="w-2 h-2 rounded-full animate-bounce bg-gray-400" style={{animationDelay: '0.2s'}}></div>
                                <div className="w-2 h-2 rounded-full animate-bounce bg-gray-400" style={{animationDelay: '0.4s'}}></div>
                            </div>
                        )}
                        <div ref={chatEndRef} />
                    </div>

                    <form onSubmit={handleSubmit} className="p-4 border-t">
                        <div className="flex gap-2">
                            <input
                                type="text"
                                value={input}
                                onChange={(e) => setInput(e.target.value)}
                                placeholder={placeholders[language]}
                                className="flex-1 p-2 border rounded"
                                disabled={isLoading}
                            />
                            <button 
                                type="submit"
                                disabled={isLoading}
                                className="p-2 bg-blue-500 text-white rounded hover:bg-blue-600 disabled:opacity-50"
                            >
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                                    <line x1="22" y1="2" x2="11" y2="13"></line>
                                    <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                                </svg>
                            </button>
                        </div>
                    </form>
                </div>
            );
        };

        // åˆå§‹åŒ–æ¸²æŸ“
        ReactDOM.render(
            <ChatBot language="ko" />,
            document.getElementById('chatbot-root')
        );

        // è¯­è¨€åˆ‡æ¢å¤„ç†
        document.querySelectorAll('.lang-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const lang = btn.dataset.lang;
                document.querySelectorAll('.lang-btn').forEach(b => 
                    b.classList.toggle('bg-blue-600', b.dataset.lang === lang)
                );
                ReactDOM.render(
                    <ChatBot language={lang} />,
                    document.getElementById('chatbot-root')
                );
            });
        });
    </script>
</body>
</html>